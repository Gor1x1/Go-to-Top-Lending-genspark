# Go to Top โ CRM + Landing + Admin Panel

## ะะฑะทะพั ะฟัะพะตะบัะฐ
- **ะะฐะทะฒะฐะฝะธะต**: Go to Top โ ะัะพะดะฒะธะถะตะฝะธะต ะฝะฐ Wildberries (ะัะผะตะฝะธั)
- **ะฆะตะปั**: ะะพะปะฝะพัะตะฝะฝะฐั CRM-ัะธััะตะผะฐ + ะปะตะฝะดะธะฝะณ + ะบะฐะปัะบัะปััะพั ััะปัะณ + PDF-ะณะตะฝะตัะฐัะธั ััะตัะพะฒ + ะฑะธะทะฝะตั-ะฐะฝะฐะปะธัะธะบะฐ
- **ะะปะฐััะพัะผะฐ**: Cloudflare Pages + D1 (SQLite ะฝะฐ edge)
- **ะฏะทัะบะธ**: ะัััะบะธะน (RU) + ะัะผัะฝัะบะธะน (AM), ัะฐััะธัะฝะพ English

---

## ๐ URLs

| ะะตัััั | URL |
|--------|-----|
| **ะัะพะดะฐะบัะฝ ัะฐะนั (ะปะตะฝะดะธะฝะณ)** | https://gototop-lending.pages.dev |
| **ะะดะผะธะฝ-ะฟะฐะฝะตะปั** | https://gototop-lending.pages.dev/admin |
| **PDF-ััะตั (ะฟัะธะผะตั)** | https://gototop-lending.pages.dev/pdf/1 |
| **GitHub** | https://github.com/Gor1x1/Go-to-Top-Lending-genspark |
| **Cloudflare Dashboard** | https://dash.cloudflare.com โ Pages โ gototop-lending |

> **ะัะธะผะตัะฐะฝะธะต**: Cloudflare Pages ะฟัะพะตะบั ะฝะฐะทัะฒะฐะตััั `gototop-lending`, ะฝะพ ะฒ `wrangler.jsonc` name = `gototop-wb` (ััะพ legacy-ะธะผั Workers).

---

## ๐ ะะพัััะฟ ะบ ะฐะดะผะธะฝ-ะฟะฐะฝะตะปะธ

| ะะพะปะต | ะะฝะฐัะตะฝะธะต |
|------|----------|
| **URL** | `/admin` |
| **ะะพะณะธะฝ** | `admin` |
| **ะะฐัะพะปั** | `gototop2026` |
| **ะััะตะฝัะธัะธะบะฐัะธั** | JWT (SHA-256 HMAC, Web Crypto API) |
| **ะกัะพะบ ัะพะบะตะฝะฐ** | 7 ะดะฝะตะน |

> โ๏ธ **ะกะผะตะฝะธัะต ะฟะฐัะพะปั ะฟัะธ ะฟะตัะฒะพะผ ะฒัะพะดะต!** ะะฐัััะพะนะบะธ โ ะกะผะตะฝะฐ ะฟะฐัะพะปั

---

## ๐๏ธ ะััะธัะตะบัััะฐ ะธ ััะตะบ ัะตัะฝะพะปะพะณะธะน

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Cloudflare Pages (Edge)                       โ
โ                                                                 โ
โ  โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ  โ
โ  โ  Hono (TS)   โโโโโถโ  D1 (SQLite) โ    โ  Static Assets   โ  โ
โ  โ  Backend API โ    โ  35+ ัะฐะฑะปะธั  โ    โ  /public/static/ โ  โ
โ  โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ  โ
โ         โ                                                       โ
โ  โโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ  โ  Routes: /, /admin, /pdf/:id, /api/*                     โ   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

| ะะพะผะฟะพะฝะตะฝั | ะขะตัะฝะพะปะพะณะธั |
|-----------|-----------|
| **Backend** | Hono 4.x (TypeScript) ะฝะฐ Cloudflare Workers |
| **Frontend (ะปะตะฝะดะธะฝะณ)** | Vanilla HTML/CSS/JS + TailwindCSS (CDN) |
| **Admin panel** | SPA ะฝะฐ ัะธััะพะผ JS (single-page, `src/admin/panel.ts`) |
| **Database** | Cloudflare D1 (`gototop-production`) |
| **Auth** | JWT + SHA-256 HMAC (Web Crypto API) |
| **Build** | Vite + @hono/vite-build |
| **Deploy** | Wrangler CLI โ Cloudflare Pages |
| **ะฃะฒะตะดะพะผะปะตะฝะธั** | Telegram Bot API |

---

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
webapp/
โโโ src/
โ   โโโ index.tsx              # ะะปะฐะฒะฝัะน entry point โ ะฒัะต ะฟัะฑะปะธัะฝัะต ัะพััั
โ   โ                          # (ะปะตะฝะดะธะฝะณ, ะบะฐะปัะบัะปััะพั, PDF, lead-ัะพัะผั, tracking)
โ   โโโ api/
โ   โ   โโโ admin.ts           # ะัะต API-ัะฝะดะฟะพะธะฝัั ะฐะดะผะธะฝะบะธ (~3900 ัััะพะบ)
โ   โ                          # (CRUD ะบะพะฝัะตะฝัะฐ, ะบะฐะปัะบัะปััะพัะฐ, ะปะธะดะพะฒ, ะฐะฝะฐะปะธัะธะบะธ,
โ   โ                          #  ะบัะตะดะธัะพะฒ, ัะพัััะดะฝะธะบะพะฒ, ัะฐััะพะดะพะฒ, ะฝะฐะปะพะณะพะฒ ะธ ั.ะด.)
โ   โโโ admin/
โ   โ   โโโ panel.ts           # SPA-ะบะพะด ะฐะดะผะธะฝ-ะฟะฐะฝะตะปะธ (~8500 ัััะพะบ)
โ   โ                          # (ะฒะตัั UI, ะปะพะณะธะบะฐ, ัะตะฝะดะตั, ะฒะฐะปะธะดะฐัะธั)
โ   โโโ lib/
โ   โ   โโโ db.ts              # ะะฝะธัะธะฐะปะธะทะฐัะธั D1 ะะ, ะฒัะต CREATE TABLE + ะผะธะณัะฐัะธะธ
โ   โ   โโโ auth.ts            # JWT ะฐะฒัะพัะธะทะฐัะธั, ัะตัะธัะพะฒะฐะฝะธะต ะฟะฐัะพะปะตะน
โ   โโโ renderer.tsx           # Hono HTML renderer (ะตัะปะธ ะฝัะถะตะฝ)
โ   โโโ seed-data.ts           # ะะฐัะฐะปัะฝัะต ะดะฐะฝะฝัะต ะดะปั ะปะตะฝะดะธะฝะณะฐ
โโโ public/
โ   โโโ static/
โ       โโโ style.css          # ะะพะฟะพะปะฝะธัะตะปัะฝัะต CSS-ััะธะปะธ
โโโ migrations/
โ   โโโ 0001_initial_schema.sql # SQL-ะผะธะณัะฐัะธั (ััััะบัััะฐ)
โโโ seed.sql                   # ะขะตััะพะฒัะต ะดะฐะฝะฝัะต ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ
โโโ seed-production.sql        # ะะฐะฝะฝัะต ะดะปั ะฟัะพะดะฐะบัะฝะฐ
โโโ ecosystem.config.cjs       # PM2 ะบะพะฝัะธะณััะฐัะธั (ะดะปั sandbox dev)
โโโ wrangler.jsonc             # Cloudflare Workers ะบะพะฝัะธะณััะฐัะธั
โโโ vite.config.ts             # Vite build ะบะพะฝัะธะณััะฐัะธั
โโโ tsconfig.json              # TypeScript ะบะพะฝัะธะณััะฐัะธั
โโโ package.json               # ะะฐะฒะธัะธะผะพััะธ ะธ ัะบัะธะฟัั
โโโ .gitignore                 # ะะณะฝะพัะธััะตะผัะต ัะฐะนะปั
```

---

## ๐๏ธ ะะฐะทะฐ ะดะฐะฝะฝัั (Cloudflare D1)

**Database name**: `gototop-production`  
**Database ID**: `8b74a4aa-4685-48c4-9e99-eaa7d8aae3e2`

### ะัะฝะพะฒะฝัะต ัะฐะฑะปะธัั (35+):

| ะขะฐะฑะปะธัะฐ | ะะฟะธัะฐะฝะธะต |
|---------|----------|
| `users` | ะะพะปัะทะพะฒะฐัะตะปะธ (admin, ัะพัััะดะฝะธะบะธ) |
| `user_permissions` | ะัะฐะฒะฐ ะดะพัััะฟะฐ ัะพัััะดะฝะธะบะพะฒ |
| `site_content` | ะะพะฝัะตะฝั ัะฐะนัะฐ (ัะตะบััั ะฝะฐ RU/AM ะฟะพ ัะตะบัะธัะผ) |
| `site_blocks` | ะะปะพะบะธ ัะฐะนัะฐ (ะฟะพััะดะพะบ, ะฒะธะดะธะผะพััั) |
| `calculator_tabs` | ะะบะปะฐะดะบะธ ะบะฐะปัะบัะปััะพัะฐ |
| `calculator_services` | ะฃัะปัะณะธ (ัะตะฝั, ัะฐัะธัะฝัะต ัะบะฐะปั, ะฟะพััะดะพะบ) |
| `telegram_messages` | ะจะฐะฑะปะพะฝั Telegram-ัะพะพะฑัะตะฝะธะน |
| `telegram_bot_config` | ะะฐัััะพะนะบะธ Telegram ะฑะพัะฐ |
| `custom_scripts` | ะกะบัะธะฟัั ะฐะฝะฐะปะธัะธะบะธ (head/body) |
| `leads` | ะะธะดั/ะทะฐัะฒะบะธ (ะบะปะธะตะฝัั, ััะผะผั, ััะฐัััั) |
| `lead_comments` | ะะพะผะผะตะฝัะฐัะธะธ ะบ ะปะธะดะฐะผ |
| `lead_articles` | ะััะธะบัะปั WB ะฟัะธะฒัะทะฐะฝะฝัะต ะบ ะปะธะดะฐะผ |
| `referral_codes` | ะัะพะผะพะบะพะดั (ัะบะธะดะบะธ, ะปะธะผะธัั, ััะฐัะธััะธะบะฐ) |
| `referral_free_services` | ะะตัะฟะปะฐัะฝัะต ััะปัะณะธ ะฟะพ ะฟัะพะผะพะบะพะดะฐะผ |
| `pdf_templates` | ะจะฐะฑะปะพะฝ PDF-ััััะฐ (ะผัะปััะธัะทััะฝัะน) |
| `slot_counter` | ะกััััะธะบ ัะฒะพะฑะพะดะฝัั ะผะตัั |
| `section_order` | ะะพััะดะพะบ ัะตะบัะธะน ะฝะฐ ะปะตะฝะดะธะฝะณะต |
| `footer_settings` | ะะฐัััะพะนะบะธ ัััะตัะฐ |
| `photo_blocks` | ะะปะพะบะธ ั ัะพัะพะณัะฐัะธัะผะธ |
| `page_views` | ะะฝะฐะปะธัะธะบะฐ ะฟัะพัะผะพััะพะฒ |
| `activity_log` | ะะพะณ ะดะตะนััะฒะธะน |
| `activity_sessions` | ะกะตััะธะธ ะฐะบัะธะฒะฝะพััะธ ัะพัััะดะฝะธะบะพะฒ |
| `expenses` | ะะฐััะพะดั (ัะตะณัะปััะฝัะต ะธ ัะฐะทะพะฒัะต) |
| `expense_categories` | ะะฐัะตะณะพัะธะธ ัะฐััะพะดะพะฒ |
| `expense_frequency_types` | ะขะธะฟั ัะฐััะพัั ัะฐััะพะดะพะฒ |
| `loans` | ะัะตะดะธัั/ะทะฐะนะผั |
| `loan_payments` | ะะปะฐัะตะถะธ ะฟะพ ะบัะตะดะธัะฐะผ |
| `dividends` | ะะธะฒะธะดะตะฝะดั |
| `other_income_expenses` | ะัะพัะธะต ะดะพัะพะดั/ัะฐััะพะดั |
| `period_snapshots` | ะกะฝะตะฟัะพัั ะฟะตัะธะพะดะพะฒ (P&L) |
| `company_roles` | ะะพะปะถะฝะพััะธ ัะพัััะดะฝะธะบะพะฒ |
| `employee_bonuses` | ะะพะฝััั ัะพัััะดะฝะธะบะพะฒ |
| `employee_vacations` | ะัะฟััะบะฐ |
| `site_settings` | ะะฑัะธะต ะฝะฐัััะพะนะบะธ ัะฐะนัะฐ |
| `tax_payments` | ะะฐะปะพะณะพะฒัะต ะฟะปะฐัะตะถะธ |
| `tax_rules` | ะัะฐะฒะธะปะฐ ะฝะฐะปะพะณะพะพะฑะปะพะถะตะฝะธั |
| `assets` | ะัะฝะพะฒะฝัะต ััะตะดััะฒะฐ |
| `uploads` | ะะฐะณััะถะตะฝะฝัะต ัะฐะนะปั |

---

## ๐ API Endpoints

### ะัะฑะปะธัะฝัะต (ะฑะตะท ะฐะฒัะพัะธะทะฐัะธะธ)

| Method | Path | ะะฟะธัะฐะฝะธะต |
|--------|------|----------|
| GET | `/` | ะะตะฝะดะธะฝะณ (ะฟะพะปะฝะฐั HTML ัััะฐะฝะธัะฐ) |
| GET | `/admin` | ะะดะผะธะฝ-ะฟะฐะฝะตะปั (SPA) |
| GET | `/pdf/:id` | PDF-ัััั ะฟะพ ID ะปะธะดะฐ |
| GET | `/api/site-data` | ะัะต ะดะฐะฝะฝัะต ะดะปั ัะตะฝะดะตัะฐ ัะฐะนัะฐ (ะบะพะฝัะตะฝั, ะบะฐะปัะบัะปััะพั, telegram) |
| GET | `/api/health` | Health check |
| GET | `/api/slots` | ะขะตะบััะธะน ัััััะธะบ ัะฒะพะฑะพะดะฝัั ะผะตัั |
| GET | `/api/footer` | ะะฐะฝะฝัะต ัััะตัะฐ |
| GET | `/api/photo-blocks` | ะคะพัะพะฑะปะพะบะธ |
| POST | `/api/lead` | ะัะฟัะฐะฒะบะฐ ะปะธะด-ัะพัะผั |
| POST | `/api/popup-lead` | ะัะฟัะฐะฒะบะฐ popup-ะปะธะดะฐ |
| POST | `/api/button-lead` | ะัะฟัะฐะฒะบะฐ ะปะธะดะฐ ะฟะพ ะบะฝะพะฟะบะต |
| POST | `/api/generate-pdf` | ะะตะฝะตัะฐัะธั PDF-ััััะฐ (ะฒะพะทะฒัะฐัะฐะตั URL) |
| POST | `/api/track` | ะขัะตะบะธะฝะณ ะฟัะพัะผะพััะพะฒ ัััะฐะฝะธั |
| POST | `/api/referral/check` | ะัะพะฒะตัะบะฐ ะฟัะพะผะพะบะพะดะฐ |

### ะะดะผะธะฝ API (ััะตะฑัะตั JWT ะฒ header `Authorization: Bearer <token>`)

ะัะต ัะฝะดะฟะพะธะฝัั ะฝะธะถะต ะธะผะตัั ะฟัะตัะธะบั `/api/admin/`

| Method | Path | ะะฟะธัะฐะฝะธะต |
|--------|------|----------|
| POST | `/login` | ะะพะณะธะฝ (ะฒะพะทะฒัะฐัะฐะตั JWT) |
| POST | `/refresh-token` | ะะฑะฝะพะฒะปะตะฝะธะต JWT |
| POST | `/change-password` | ะกะผะตะฝะฐ ะฟะฐัะพะปั |
| POST | `/init-db` | ะะฝะธัะธะฐะปะธะทะฐัะธั/ะผะธะณัะฐัะธั ะะ |
| GET | `/bulk-data` | ะัะต ะดะฐะฝะฝัะต ะฐะดะผะธะฝะบะธ ะพะดะฝะธะผ ะทะฐะฟัะพัะพะผ |
| **ะะพะฝัะตะฝั** | | |
| GET/PUT | `/content/:key` | CRUD ะบะพะฝัะตะฝัะฐ ัะฐะนัะฐ ะฟะพ ะบะปััั |
| POST | `/content` | ะกะพะทะดะฐัั ะฝะพะฒัะน ะบะพะฝัะตะฝั |
| DELETE | `/content/:key` | ะฃะดะฐะปะธัั ะบะพะฝัะตะฝั |
| **ะะฐะปัะบัะปััะพั** | | |
| GET/POST | `/calc-tabs` | ะะบะปะฐะดะบะธ ะบะฐะปัะบัะปััะพัะฐ |
| PUT/DELETE | `/calc-tabs/:id` | ะฃะฟัะฐะฒะปะตะฝะธะต ะฒะบะปะฐะดะบะพะน |
| GET/POST | `/calc-services` | ะฃัะปัะณะธ ะบะฐะปัะบัะปััะพัะฐ |
| PUT/DELETE | `/calc-services/:id` | ะฃะฟัะฐะฒะปะตะฝะธะต ััะปัะณะพะน |
| PUT | `/calc-services-reorder` | ะะทะผะตะฝะตะฝะธะต ะฟะพััะดะบะฐ ััะปัะณ (drag & drop) |
| **Telegram** | | |
| CRUD | `/telegram` | ะจะฐะฑะปะพะฝั Telegram-ัะพะพะฑัะตะฝะธะน |
| CRUD | `/telegram-bot` | ะะฐัััะพะนะบะธ Telegram ะฑะพัะฐ |
| **ะะธะดั** | | |
| GET | `/leads?limit=N` | ะกะฟะธัะพะบ ะปะธะดะพะฒ |
| GET | `/leads/export` | ะญะบัะฟะพัั ะปะธะดะพะฒ |
| GET | `/leads/analytics` | ะะฝะฐะปะธัะธะบะฐ ะปะธะดะพะฒ |
| POST | `/leads` | ะกะพะทะดะฐัั ะปะธะด ะฒัััะฝัั |
| PUT/DELETE | `/leads/:id` | ะฃะฟัะฐะฒะปะตะฝะธะต ะปะธะดะพะผ |
| GET/POST | `/leads/:id/comments` | ะะพะผะผะตะฝัะฐัะธะธ ะบ ะปะธะดั |
| DELETE | `/leads/comments/:commentId` | ะฃะดะฐะปะธัั ะบะพะผะผะตะฝัะฐัะธะน |
| **ะัะพะผะพะบะพะดั** | | |
| CRUD | `/referrals` | ะัะพะผะพะบะพะดั |
| GET | `/referral-codes/check` | ะัะพะฒะตัะบะฐ ะฟัะพะผะพะบะพะดะฐ |
| GET/POST/DELETE | `/referrals/:id/services` | ะะตัะฟะปะฐัะฝัะต ััะปัะณะธ ะฟะพ ะฟัะพะผะพะบะพะดั |
| **ะคะธะฝะฐะฝัั** | | |
| GET | `/business-analytics?from=&to=` | ะะธะทะฝะตั-ะฐะฝะฐะปะธัะธะบะฐ (P&L, KPI, LTV) |
| CRUD | `/loans` | ะัะตะดะธัั |
| POST | `/loans/:id/payments` | ะะปะฐัะตะถะธ ะฟะพ ะบัะตะดะธัะฐะผ |
| CRUD | `/dividends` | ะะธะฒะธะดะตะฝะดั |
| CRUD | `/other-income-expenses` | ะัะพัะธะต ะดะพัะพะดั/ัะฐััะพะดั |
| CRUD | `/expenses` | ะะฐััะพะดั |
| GET/PUT | `/loan-settings` | ะะฐัััะพะนะบะธ ะบัะตะดะธัะฝะพะณะพ ะผะพะดัะปั |
| **ะกะพัััะดะฝะธะบะธ** | | |
| CRUD | `/users` (ัะตัะตะท bulk-data) | ะะพะปัะทะพะฒะฐัะตะปะธ |
| CRUD | `/users/:id/vacations` | ะัะฟััะบะฐ |
| GET | `/users/:id/earnings/:month` | ะะฐัะฟะปะฐัะฐ ัะพัััะดะฝะธะบะฐ ะทะฐ ะผะตััั |
| POST | `/activity/heartbeat` | Heartbeat ะฐะบัะธะฒะฝะพััะธ |
| GET | `/activity/online` | ะะฝะปะฐะนะฝ-ััะฐััั ัะพัััะดะฝะธะบะพะฒ |
| **ะะฐะปะพะณะธ** | | |
| CRUD | `/tax-payments` | ะะฐะปะพะณะพะฒัะต ะฟะปะฐัะตะถะธ |
| CRUD | `/tax-rules` | ะัะฐะฒะธะปะฐ ะฝะฐะปะพะณะพะพะฑะปะพะถะตะฝะธั |
| POST | `/tax-rules/generate/:periodKey` | ะะฒัะพ-ะณะตะฝะตัะฐัะธั ะฝะฐะปะพะณะพะฒ ะทะฐ ะฟะตัะธะพะด |
| GET | `/tax-summary/:periodKey` | ะกะฒะพะดะบะฐ ะฝะฐะปะพะณะพะฒ ะทะฐ ะฟะตัะธะพะด |
| GET | `/pnl/:periodKey` | P&L ะพัััั ะทะฐ ะฟะตัะธะพะด |
| **ะัะพัะตะต** | | |
| GET/PUT | `/pdf-template` | ะจะฐะฑะปะพะฝ PDF-ััััะฐ |
| CRUD | `/slot-counter` | ะกััััะธะบ ัะปะพัะพะฒ |
| CRUD | `/footer` | ะะฐัััะพะนะบะธ ัััะตัะฐ |
| CRUD | `/photo-blocks` | ะคะพัะพะฑะปะพะบะธ |
| CRUD | `/scripts` | ะะฐััะพะผะฝัะต ัะบัะธะฟัั |
| GET/PUT | `/section-order` | ะะพััะดะพะบ ัะตะบัะธะน |
| CRUD | `/assets` | ะัะฝะพะฒะฝัะต ััะตะดััะฒะฐ |
| GET/PUT | `/settings` | ะะฑัะธะต ะฝะฐัััะพะนะบะธ |

---

## ๐งฎ ะคัะฝะบัะธะพะฝะฐะป

### ะะตะฝะดะธะฝะณ
- ะัะปััะธัะทััะฝัะน (RU/AM) ั ะฟะตัะตะบะปััะฐัะตะปะตะผ
- ะะฐะปัะบัะปััะพั ััะปัะณ ั ัะฐัะธัะฝัะผะธ ัะบะฐะปะฐะผะธ (tiered pricing)
- Popup-ัะพัะผะฐ (ะฟะพัะฒะปัะตััั ัะตัะตะท 5 ัะตะบ)
- ะะฝัะตะณัะฐัะธั Telegram/WhatsApp โ ะฟััะผะฐั ะพัะฟัะฐะฒะบะฐ ะทะฐัะฒะบะธ
- ะกััััะธะบ ัะฒะพะฑะพะดะฝัั ะผะตัั (ัะตะฐะปัะฝัะน FOMO)
- ะะดะฐะฟัะธะฒะฝัะน ะดะธะทะฐะนะฝ (mobile-first)
- ะะฝะธะผะฐัะธะธ ะฟัะธ ัะบัะพะปะปะต, ัััััะธะบะธ
- Lightbox ะดะปั ะธะทะพะฑัะฐะถะตะฝะธะน
- FAQ-ะฑะปะพะบ

### PDF-ะณะตะฝะตัะฐัะธั
- ะะตะฝะตัะฐัะธั ะบะพะผะผะตััะตัะบะพะณะพ ะฟัะตะดะปะพะถะตะฝะธั ะธะท ะบะฐะปัะบัะปััะพัะฐ
- ะัะปััะธัะทััะฝัะต ัะฐะฑะปะพะฝั (RU/AM/EN)
- ะัะพะผะพะบะพะดั ะธ ัะบะธะดะบะธ
- ะะฐััะพะผะธะทะธััะตะผัะต ะฟะพะปั ัะตัะตะท ะฐะดะผะธะฝะบั
- ะกะบะฐัะธะฒะฐะฝะธะต ัะตัะตะท `window.print()` (ั ะฐะณัะตััะธะฒะฝัะผ ัะบัััะธะตะผ ะฟะปะฐะณะธะฝะพะฒ)
- ะะฒัะพะผะฐัะธัะตัะบะพะต ัะฒะตะดะพะผะปะตะฝะธะต ะฒ Telegram ะฟัะธ ะณะตะฝะตัะฐัะธะธ

### ะะดะผะธะฝ-ะฟะฐะฝะตะปั (ัะฐะทะดะตะปั)
1. ๐ **ะะฐัะฑะพัะด** โ KPI, ะบะพะฝะฒะตััะธั, ััะตะดะฝะธะน ัะตะบ, ROI, ROMI, LTV, CAC
2. ๐ **ะขะตะบััั ัะฐะนัะฐ** โ ัะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะฒัะตั ัะตะบััะพะฒ ะฝะฐ RU + AM (20+ ัะตะบัะธะน)
3. ๐งฎ **ะะฐะปัะบัะปััะพั** โ ะฒะบะปะฐะดะบะธ, ััะปัะณะธ, ัะตะฝั, ัะฐัะธัะฝัะต ัะบะฐะปั (drag & drop)
4. ๐ฌ **Telegram** โ ัะพะพะฑัะตะฝะธั, ะฑะพั, ัะฐะฑะปะพะฝั (2 ัะทัะบะฐ)
5. ๐ **ะะธะดั** โ CRM (ััะฐัััั, ะบะพะผะผะตะฝัะฐัะธะธ, ัะธะปัััั, ัะบัะฟะพัั)
6. ๐ **ะัะพะผะพะบะพะดั** โ ัะบะธะดะบะธ, ะฑะตัะฟะปะฐัะฝัะต ััะปัะณะธ, ะปะธะผะธัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั
7. ๐ฐ **ะคะธะฝะฐะฝัั** โ P&L, ัะฐััะพะดั, ะดะพัะพะดั, ะบัะตะดะธัั, ะดะธะฒะธะดะตะฝะดั, ะฝะฐะปะพะณะธ
8. ๐ฅ **ะกะพัััะดะฝะธะบะธ** โ ัะพะปะธ, ะทะฐัะฟะปะฐัั, ะฑะพะฝััั, ะพัะฟััะบะฐ, ะพะฝะปะฐะนะฝ-ััะฐััั
9. ๐ **PDF-ัะฐะฑะปะพะฝ** โ ะฝะฐัััะพะนะบะฐ ะฒัะตั ะฟะพะปะตะน PDF-ััััะฐ
10. โ๏ธ **ะะฐัััะพะนะบะธ** โ ะพะฑัะธะต, ัะบัะธะฟัั, ัััะตั, ัะปะพัั

### ะะธะทะฝะตั-ะฐะฝะฐะปะธัะธะบะฐ
- ะกัะตะดะฝะธะน ัะตะบ, ะผะฐัะถะธะฝะฐะปัะฝะพััั, ROI, ROMI
- LTV (ัะพัะผัะปะฐ: avg check ร frequency ร lifespan)
- CAC (ััะพะธะผะพััั ะฟัะธะฒะปะตัะตะฝะธั ะบะปะธะตะฝัะฐ)
- ะะพะฝะฒะตััะธั, % ะพัะบะฐะทะพะฒ
- ะัะพะผะพ-ะฐะฝะฐะปะธัะธะบะฐ (ะขะะ-5 ะฟัะพะผะพะบะพะดะพะฒ, ROI ะฟัะพะผะพ)
- ะัะตะดะธัะฝะฐั ะฝะฐะณััะทะบะฐ (ะดะพะปะณ/ะฒััััะบะฐ, ะดะพะปะณ/ะฟัะธะฑัะปั)
- P&L ะพััััั ะฟะพ ะฟะตัะธะพะดะฐะผ

---

## ๐ ะะฐะบ ะทะฐะฟัััะธัั ะปะพะบะฐะปัะฝะพ

### ะขัะตะฑะพะฒะฐะฝะธั
- Node.js 18+
- npm

### ะฃััะฐะฝะพะฒะบะฐ

```bash
git clone https://github.com/Gor1x1/Go-to-Top-Lending-genspark.git
cd Go-to-Top-Lending-genspark
npm install
```

### ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

```bash
# 1. ะกะฑะพัะบะฐ
npm run build

# 2. ะะฐะฟััะบ ั ะปะพะบะฐะปัะฝะพะน D1
npx wrangler pages dev dist --d1=gototop-production --local --ip 0.0.0.0 --port 3000

# ะะปะธ ัะตัะตะท PM2 (ัะตะบะพะผะตะฝะดัะตััั)
pm2 start ecosystem.config.cjs
```

**ะกะฐะนั**: http://localhost:3000  
**ะะดะผะธะฝะบะฐ**: http://localhost:3000/admin

### ะงะตัะตะท Vite (hot reload, ะฑะตะท D1)

```bash
npm run dev
# ะัะบัะพะตััั http://localhost:5173
```

> โ๏ธ `npm run dev` ัะฐะฑะพัะฐะตั ัะตัะตะท Vite dev server ะะะ D1 ะฑะฐะทั. ะะปั ะฟะพะปะฝะพะณะพ ััะฝะบัะธะพะฝะฐะปะฐ ะธัะฟะพะปัะทัะนัะต `wrangler pages dev`.

---

## ๐ฆ Deploy ะฝะฐ Cloudflare Pages

### ะะตัะฒัะน ะดะตะฟะปะพะน

```bash
# 1. ะะฒัะพัะธะทะฐัะธั
export CLOUDFLARE_API_TOKEN=ะฒะฐั_ัะพะบะตะฝ
npx wrangler whoami

# 2. ะกะพะทะดะฐะฝะธะต ะฟัะพะตะบัะฐ (ัะถะต ัะพะทะดะฐะฝ ะบะฐะบ gototop-lending)
npx wrangler pages project create gototop-lending --production-branch main

# 3. ะกะพะทะดะฐะฝะธะต D1 ะฑะฐะทั (ัะถะต ัะพะทะดะฐะฝะฐ)
npx wrangler d1 create gototop-production
# ะกะบะพะฟะธัะพะฒะฐัั database_id ะฒ wrangler.jsonc

# 4. ะกะฑะพัะบะฐ ะธ ะดะตะฟะปะพะน
npm run build
npx wrangler pages deploy dist --project-name gototop-lending
```

### ะะฑะฝะพะฒะปะตะฝะธะต (ะฟะพะฒัะพัะฝัะน ะดะตะฟะปะพะน)

```bash
npm run build
npx wrangler pages deploy dist --project-name gototop-lending
```

### ะะฐะฑะพัะฐ ั D1 ะฒ ะฟัะพะดะฐะบัะฝะต

```bash
# ะัะฟะพะปะฝะธัั SQL
npx wrangler d1 execute gototop-production --command="SELECT COUNT(*) FROM leads"

# ะัะธะผะตะฝะธัั ะผะธะณัะฐัะธะธ
npx wrangler d1 migrations apply gototop-production

# ะกะธะด ะดะฐะฝะฝัั
npx wrangler d1 execute gototop-production --file=./seed-production.sql
```

---

## โ๏ธ ะะพะฝัะธะณััะฐัะธั

### wrangler.jsonc
```jsonc
{
  "name": "gototop-wb",
  "compatibility_date": "2026-02-15",
  "pages_build_output_dir": "./dist",
  "compatibility_flags": ["nodejs_compat"],
  "d1_databases": [{
    "binding": "DB",
    "database_name": "gototop-production",
    "database_id": "8b74a4aa-4685-48c4-9e99-eaa7d8aae3e2"
  }]
}
```

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
ะะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ ัะพะทะดะฐะนัะต `.dev.vars`:
```
# ะะต ััะตะฑัะตััั โ ะฒัะต ัะตะบัะตัั ะทะฐัะฐัะดะบะพะถะตะฝั ะฒ ะบะพะดะต
# (Telegram token, admin password, JWT secret)
# ะ ะฑัะดััะตะผ ะฟะตัะตะฝะตััะธ ะฒ Cloudflare Secrets:
# ADMIN_PASSWORD=gototop2026
# JWT_SECRET=gtt-admin-jwt-secret-2026
# TELEGRAM_BOT_TOKEN=ะฒะฐั_ัะพะบะตะฝ
```

---

## ๐ง ะะฐะถะฝัะต ะพัะพะฑะตะฝะฝะพััะธ ะดะปั ัะฐะทัะฐะฑะพััะธะบะฐ

### 1. ะะฝะธัะธะฐะปะธะทะฐัะธั ะะ
ะัะธ ะบะฐะถะดะพะผ ะทะฐะฟัะพัะต ะฒัะทัะฒะฐะตััั `initDatabase(db)` ะธะท `src/lib/db.ts`. ะคัะฝะบัะธั:
- ะกะพะทะดะฐัั ะฒัะต ัะฐะฑะปะธัั (`CREATE TABLE IF NOT EXISTS`)
- ะัะฟะพะปะฝัะตั ะผะธะณัะฐัะธะธ (`ALTER TABLE ADD COLUMN` ะฒ try/catch)
- ะกะพะทะดะฐัั ะดะตัะพะปัะฝะพะณะพ ะฐะดะผะธะฝะฐ

> ๐ก ะัะปะธ ะฝัะถะฝะพ ะดะพะฑะฐะฒะธัั ะฝะพะฒัะน ััะพะปะฑะตั โ ะดะพะฑะฐะฒะปัะน `ALTER TABLE` ะฒ ะบะพะฝะตั `initDatabase()` ะฒ ะพัะดะตะปัะฝะพะผ `try/catch`.

### 2. ะขะฐัะธัะฝัะต ัะบะฐะปั (tiered pricing)
- ะฅัะฐะฝัััั ะฒ `calculator_services.price_tiers_json` ะบะฐะบ JSON
- ะคะพัะผะฐั: `[{"min":1,"max":20,"price":500},{"min":21,"max":40,"price":425}]`
- ะัะธ ัะตะฝะดะตัะต ะฒ HTML: ะบะฐะฒััะบะธ ัะบัะฐะฝะธัััััั ะบะฐะบ `&quot;` ะฒ `data-tiers` ะฐััะธะฑััะต
- ะะพะดะตะปั: flat-rate (ะฒัั qty ร ัะตะฝะฐ ะธะท ะฟะพะดัะพะดััะตะณะพ ัะธัะฐ), ะะ progressive

### 3. PDF-ะณะตะฝะตัะฐัะธั
- POST `/api/generate-pdf` โ ัะพะทะดะฐัั ะปะธะด ะฒ ะะ โ ะฒะพะทะฒัะฐัะฐะตั `{ leadId, url }`
- GET `/pdf/:id` โ ัะตะฝะดะตัะธั ะฟะพะปะฝัะน HTML ะธะท ะปะธะดะฐ + ัะฐะฑะปะพะฝะฐ ะธะท ะะ
- `cleanAndPrint()` โ ะฟะตัะตะด ะฟะตัะฐััั ัะดะฐะปัะตั ะฟะปะฐะณะธะฝั/ัะฐััะธัะตะฝะธั ะฑัะฐัะทะตัะฐ
- CSS `@media print` โ ัะบััะฒะฐะตั ะฒัั ะบัะพะผะต `#pc` ะบะพะฝัะตะนะฝะตัะฐ

### 4. ะะดะผะธะฝ-ะฟะฐะฝะตะปั
- ะะดะธะฝ ะพะณัะพะผะฝัะน SPA ัะฐะนะป: `src/admin/panel.ts` (~8500 ัััะพะบ)
- ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั: `GET /api/admin/bulk-data` โ ะฒัะต ะดะฐะฝะฝัะต ะพะดะฝะธะผ ะทะฐะฟัะพัะพะผ
- ะะตะฝะดะตั: ัะธัััะน JS (document.getElementById, innerHTML)
- ะะฐะฒะธะณะฐัะธั: ัะตัะธ (#) ะดะปั ะฟะตัะตะบะปััะตะฝะธั ัะตะบัะธะน

### 5. ะะฒัะพัะธะทะฐัะธั
- JWT ั HMAC SHA-256 ัะตัะตะท Web Crypto API (ะฑะตะท node:crypto)
- Middleware `authMiddleware` ะฟัะพะฒะตััะตั ัะพะบะตะฝ ะฝะฐ ะบะฐะถะดะพะผ /api/admin/* ะทะฐะฟัะพัะต
- Refresh token: POST `/api/admin/refresh-token`
- ะะฐัะพะปั ะธ JWT_SECRET ะทะฐัะฐัะดะบะพะถะตะฝั ะฒ `src/lib/auth.ts` (โ๏ธ ะฟะตัะตะฝะตััะธ ะฒ secrets!)

### 6. Cloudflare Workers ะพะณัะฐะฝะธัะตะฝะธั
- โ ะะตั `fs`, `path`, `child_process` ะธ ะดััะณะธั Node.js API
- โ ะะตั file system โ ะฒัั ััะฐะฝะธััั ะฒ D1
- โ CPU limit: 10ms free / 30ms paid
- โ Web APIs: fetch, crypto.subtle, TextEncoder, etc.
- โ Cloudflare D1 ะดะปั ะดะฐะฝะฝัั

---

## โ๏ธ ะะทะฒะตััะฝัะต TODO / ะขะตัะฝะธัะตัะบะธะน ะดะพะปะณ

1. **ะกะตะบัะตัั** โ ะฟะตัะตะฝะตััะธ `ADMIN_PASSWORD`, `JWT_SECRET` ะธะท ะบะพะดะฐ ะฒ Cloudflare Secrets
2. **ะะฐะทะผะตั ัะฐะนะปะพะฒ** โ `panel.ts` (8500 ัััะพะบ) ะธ `index.tsx` (3600 ัััะพะบ) ะฝัะถะฝะพ ัะฐะทะฑะธัั
3. **ะขะธะฟะธะทะฐัะธั** โ ะดะพะฑะฐะฒะธัั TypeScript ัะธะฟั ะดะปั D1 ะผะพะดะตะปะตะน
4. **ะขะตััั** โ ะฝะตั unit/integration ัะตััะพะฒ
5. **Rate limiting** โ ะฝะตั ะทะฐัะธัั ะพั brute-force ะฝะฐ /login
6. **CORS** โ ะฝะฐัััะพะธัั ัััะพะถะต ะดะปั production
7. **ะะตั** โ ะดะพะฑะฐะฒะธัั ะบะตัะธัะพะฒะฐะฝะธะต `/api/site-data`
8. **Image upload** โ ะทะฐะณััะถะตะฝะฝัะต ะธะทะพะฑัะฐะถะตะฝะธั ััะฐะฝัััั ะบะฐะบ base64/URL, ะฝะตั R2

---

## ๐ Git-flow

```bash
# ะะปะพะฝะธัะพะฒะฐะฝะธะต
git clone https://github.com/Gor1x1/Go-to-Top-Lending-genspark.git

# ะะพะฒะฐั ัะธัะฐ
git checkout -b feature/ะฝะฐะทะฒะฐะฝะธะต
# ... code ...
git add .
git commit -m "feat: ะพะฟะธัะฐะฝะธะต"
git push origin feature/ะฝะฐะทะฒะฐะฝะธะต

# ะะตะฟะปะพะน ะฒ ะฟัะพะด (main branch)
git checkout main
git merge feature/ะฝะฐะทะฒะฐะฝะธะต
npm run build
npx wrangler pages deploy dist --project-name gototop-lending
```

---

## ๐ ะขะตะบััะธะน ััะฐััั

- **ะะปะฐััะพัะผะฐ**: Cloudflare Pages + D1
- **ะกัะฐััั**: โ ะะบัะธะฒะตะฝ
- **ะะตััะธั**: v0.5.0
- **ะะพัะปะตะดะฝะตะต ะพะฑะฝะพะฒะปะตะฝะธะต**: 2026-03-01
- **Cloudflare Project**: `gototop-lending`
- **D1 Database**: `gototop-production` (ID: `8b74a4aa-4685-48c4-9e99-eaa7d8aae3e2`)
